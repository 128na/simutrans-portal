# フェーズ3 詳細計画書

日付: 2026-01-11
ステータス: 計画立案中

## 🎯 全体目標

- **Frontend**: 50% → 70% (Statements カバレッジ)
- **Backend**: 70% → 80% (Statements カバレッジ)
- **テスト数**: 1,148 → 1,400+ (約250+ テスト追加)
- **期間**: 1-2ヶ月

---

## 📋 優先度別タスクリスト

### フェーズ3-1（高優先度: 1週間目）

**目標**: Frontend 50% → 55%, Backend 70% → 72%

#### Frontend 実装 (20テスト予定)

1. **AnalyticsPage.tsx** (15テスト)
   - グラフ表示、フィルター機能、期間選択
   - データ集計ロジック検証
   - UI インタラクション

2. **PublicProfile.tsx** (5テスト)
   - プロフィール表示、ユーザー情報
   - リンク検証、画像表示

#### Backend 実装 (15テスト予定)

1. **Service 層 - AnalyticsService.php** (8テスト)
   - データ集計ロジック
   - 日付範囲フィルター
   - 複合条件クエリ

2. **Service 層 - ProfileService.php** (7テスト)
   - プロフィール情報取得
   - キャッシュロジック
   - データ変換処理

---

### フェーズ3-2（中優先度: 2週間目）

**目標**: Frontend 55% → 60%, Backend 72% → 75%

#### Frontend 実装 (25テスト予定)

1. **MyPageLayout.tsx** (10テスト)
   - ページナビゲーション
   - サイドメニュー操作
   - 複数ページ統合動作

2. **UserSearchPage.tsx** (8テスト)
   - 検索フォーム操作
   - 結果リスト表示
   - ページング

3. **TagSearchPage.tsx** (7テスト)
   - タグ検索ロジック
   - 結果フィルター
   - カウント表示

#### Backend 実装 (20テスト予定)

1. **Repository - Article/Search** (10テスト)
   - 複合条件検索
   - タグフィルター
   - ページネーション

2. **Repository - User/Profile** (10テスト)
   - ユーザー検索
   - プロフィール取得
   - フォロー関連クエリ

---

### フェーズ3-3（中優先度: 3-4週間目）

**目標**: Frontend 60% → 65%, Backend 75% → 78%

#### Frontend 実装 (15テスト予定)

1. **E2E シナリオ - 記事作成フロー** (8テスト)
   - ログイン → 記事作成 → 公開
   - フォーム入力、プレビュー、保存
   - 完全なユーザーシナリオ

2. **E2E シナリオ - マイリスト操作** (7テスト)
   - マイリスト追加、編集、削除
   - 並び順変更、メモ編集
   - ステータス確認

#### Backend 実装 (20テスト予定)

1. **複合テスト - 記事関連の統合テスト** (10テスト)
   - 記事作成→タグ付け→公開の流れ
   - ビューカウント、コンバージョン記録
   - デッドリンク検知との連携

2. **複合テスト - ユーザー関連の統合テスト** (10テスト)
   - ユーザー登録→プロフィール設定→記事投稿の流れ
   - 権限・認証の検証
   - 通知送信との連携

---

### フェーズ3-4（低優先度: 5-6週間目）

**目標**: Frontend 65% → 70%, Backend 78% → 80%

#### Frontend 実装 (20テスト予定)

1. **Hooks 複雑な状態遷移** (12テスト)
   - useArticleEditor の複数状態パターン
   - useAnalyticsStore の並行アクセス
   - エラー回復フロー

2. **アクセシビリティテスト** (8テスト)
   - スクリーンリーダー対応確認
   - キーボードナビゲーション
   - ARIA 属性検証

#### Backend 実装 (25テスト予定)

1. **キャッシュ戦略テスト** (10テスト)
   - キャッシュ無効化タイミング
   - TTL 検証
   - キャッシュヒット/ミス

2. **パフォーマンステスト** (8テスト)
   - 大量データ処理
   - N+1 クエリ回避確認
   - インデックス活用検証

3. **エッジケーステスト** (7テスト)
   - 境界値テスト
   - 特殊文字・言語対応
   - 同時実行処理

---

## 📊 タスク一覧表

| フェーズ | 週数 | Frontend | Backend  | 合計    | 期間      | 状態 |
| -------- | ---- | -------- | -------- | ------- | --------- | ---- |
| 3-1      | 1    | 20テスト | 15テスト | 35      | 1週間目   | 予定 |
| 3-2      | 2    | 25テスト | 20テスト | 45      | 2週間目   | 予定 |
| 3-3      | 3-4  | 15テスト | 20テスト | 35      | 3-4週間目 | 予定 |
| 3-4      | 5-6  | 20テスト | 25テスト | 45      | 5-6週間目 | 予定 |
| **合計** | 6    | **80**   | **80**   | **160** | 6週間     |      |

---

## 🚀 実装手順

### フェーズ3-1 実装計画（詳細）

#### 1. AnalyticsPage.tsx テスト (15テスト)

```typescript
// 想定テストケース:
- レンダリング: ページ初期表示、タイトル確認
- グラフ表示: Recharts グラフレンダリング、データ反映
- フィルター機能: 期間選択、記事フィルター
- データ集計: 合計PV/CV 計算、日別集計
- API 呼び出し: フィルター変更時の再取得
- エラーハンドリング: API エラー表示、リトライ
- ローディング状態: ローディング表示、スケルトン
- UI インタラクション: ボタンクリック、フォーム入力
- 複数グラフ表示: PV/CV 複合グラフ
- 日付範囲バリデーション: 期間選択の有効性確認
- エクスポート機能: CSV ダウンロード（あれば）
- ローカルストレージ: フィルター設定の保持
- ズーム機能: グラフのズーム/パン（あれば）
- 複数タイプ: 記事タイプ別集計
- リアルタイム更新: 自動更新機能
```

#### 2. AnalyticsService.php テスト (8テスト)

```php
// 想定テストケース:
- 日別PV集計: 正確な計算確認
- 日別CV集計: 正確な計算確認
- 期間フィルター: 指定期間の絞り込み
- 複数記事集計: 複数記事の合計値
- キャッシュ活用: 計算結果のキャッシュ
- データなし: 期間にデータなしの処理
- 異常値処理: 負の値、ゼロ値の処理
- パフォーマンス: 大量データの処理速度
```

---

## ⚠️ 注意事項

### Playwright (E2E テスト)

- フェーズ3-3 で初導入予定
- セットアップ: `npm install -D @playwright/test`
- テスト実行: `npm run test:e2e`

### キャッシュ戦略

- Redis またはファイルキャッシュの活用
- キャッシュ無効化タイミングの検証
- テストでは cache:clear の適切な活用

### パフォーマンステスト

- 最低 5000+ レコード規模でテスト
- クエリ数の計測（debugbar またはログ）
- 実行時間の測定

---

## 📅 推奨スケジュール

| 週       | 予定                              | 完了目標      |
| -------- | --------------------------------- | ------------- |
| 1週目    | AnalyticsPage, Service テスト     | 35テスト      |
| 2週目    | MyPage, Repository テスト         | 45テスト      |
| 3-4週    | E2E テスト、統合テスト            | 35テスト      |
| 5-6週    | Hooks, キャッシュ、パフォーマンス | 45テスト      |
| **合計** | フェーズ3完了                     | **160テスト** |

---

## ✅ 次のステップ

1. **フェーズ3-1 承認**: このドキュメントの確認と方針決定
2. **AnalyticsPage.tsx テスト開始**: 15テスト追加
3. **AnalyticsService.php テスト開始**: 8テスト追加
4. **進捗レポート**: 毎週金曜に更新

---

## 🎯 成功指標（フェーズ3 終了時）

| メトリクス     | 目標      | 達成基準      |
| -------------- | --------- | ------------- |
| Frontend Stmts | 50% → 70% | 70% 以上      |
| Backend Stmts  | 70% → 80% | 80% 以上      |
| テスト数       | +160      | 1,308+ テスト |
| 全テスト通過   | 100%      | ゼロ失敗      |
| コード品質     | 向上      | バグ減少      |
